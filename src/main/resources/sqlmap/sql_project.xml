<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kantar.mapper.ProjectMapper">
    <select id="getProjectInfo" resultType="com.kantar.vo.ProjectVO">
        SELECT * FROM KT_PROJECT
    </select>

    <select id="getProjectList" resultType="com.kantar.vo.ProjectVO">
        SELECT A.idx_project_job_projectid, B.job_no, A.project_id, A.filename, C.user_name, D.idx_report 
        FROM KT_PROJECT_JOB_PROJECTID A
        JOIN KT_PROJECT_JOB B ON B.idx_project_job=A.idx_project_job
        JOIN KT_USER C ON C.idx_user=A.idx_user
        JOIN KT_REPORT D ON D.idx_project_job_projectid=A.idx_project_job_projectid
    </select>

    <select id="savProjectInfo" resultType="com.kantar.vo.ProjectVO">
    <![CDATA[
		{call prc_savProjectInfo(#{idx_user}, #{job_no}, #{project_name}, #{summary0}, #{filepath}, #{filename})}
	]]>
    </select>

    <select id="getReportList" resultType="com.kantar.vo.ProjectVO">
        SELECT A.idx_project_job_projectid, B.job_no, A.project_id, A.filename, C.user_name, D.idx_report 
        FROM KT_PROJECT_JOB_PROJECTID A
        JOIN KT_PROJECT_JOB B ON B.idx_project_job=A.idx_project_job
        JOIN KT_USER C ON C.idx_user=A.idx_user
        JOIN KT_REPORT D ON D.idx_project_job_projectid=A.idx_project_job_projectid
    </select>

    <select id="getReportData" resultType="com.kantar.vo.ProjectVO">
        SELECT A.filename, C.user_name
        FROM KT_PROJECT_JOB_PROJECTID A
        WHERE A.idx_project_job_projectid=#{idx_project_job_projectid}
    </select>

    <select id="savReportMake" resultType="com.kantar.vo.ProjectVO">
        <![CDATA[
            {call prc_savReportMake(#{idx_user}, #{idx_project_job_projectid})}
        ]]>
    </select>

    <update id="comProject">
        UPDATE KT_PROJECT
            SET project_type=#{project_type},
            project_status=#{project_status}
            WHERE idx_project=#{idx_project}
    </update>
</mapper>